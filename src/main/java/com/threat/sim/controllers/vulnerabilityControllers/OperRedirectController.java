package com.threat.sim.controllers.vulnerabilityControllers;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
@RequestMapping("/or")
public class OperRedirectController {
    @GetMapping
    public String or(){
        return "or";
    }

    @GetMapping("/payment")
    public String payment(){
        return "or-payment";
    }

    //1111111111111111
    //Ara Ra
    @PostMapping("/payment")
    public String payment(Model model,
                          @RequestParam("cardnumber") String cardnumber,
                          @RequestParam("owner") String owner,
                          @RequestParam("cvv") String cvv){
        if(cardnumber.isEmpty() || owner.isEmpty() || cvv.isEmpty()){
            model.addAttribute("message", "Please fill all inputs");
            return "or-payment";
        }
        if(!cardnumber.matches("^[0-9]{16}$")){
            model.addAttribute("message", "Wrong card format");
            return "or-payment";
        }
        if(!owner.matches("^[A-Z][a-z]\\s[A-Z][a-z]$")){
            model.addAttribute("message", "Wrong owner format");
            return "or-payment";
        }
        if(!cvv.matches("^[0-9]{3}$")){
            model.addAttribute("message", "Wrong cvv format");
            return "or-payment";
        }
        model.addAttribute("message", "Your payment is being processed");
        return "or-payment";
    }
    @GetMapping("/redirect")
    public String redirect(@RequestParam String url){

        return "redirect:" + url;
    }
}
